# 管理パネルドキュメント

> **概要**: keruta管理パネルの機能、画面構成、操作方法、権限管理、今後の予定などをまとめたドキュメントです。

## 目次
- [概要](#概要)
- [アクセス方法](#アクセス方法)
- [主な画面と機能](#主な画面と機能)
- [権限ごとの操作可否](#権限ごとの操作可否)
- [ナビゲーション](#ナビゲーション)
- [技術情報](#技術情報)
- [FAQ・トラブルシューティング](#faqトラブルシューティング)
- [今後の予定](#今後の予定)

## 概要
keruta管理パネルは、タスク・ドキュメント・リポジトリ・Kubernetesリソースを管理するWebインターフェースです。

## アクセス方法
- URL: http://localhost:8080/admin
- ルートパスや/welcomeにアクセスすると自動リダイレクト

## 主な画面と機能
### ダッシュボード
- 最近のタスク概要、各機能へのクイックリンク、Swagger UIへのリンク

### タスク管理
- 一覧・詳細・新規作成・編集・削除・Podログ閲覧・エージェント設定
- 親タスク指定やPodログのリアルタイム表示・ダウンロードも可能
- タスクを削除したとき、関連するKubernetesのJobとPersistentVolumeClaim（PVC）も自動的に削除されます。
- タスクの実行ログ表示: 各タスクの実行ログ（標準出力・標準エラー出力）を管理画面からリアルタイムで閲覧できます。過去の実行ログも履歴として参照可能です。
- 実行中のPodのマニフェスト（manifest）を管理画面から確認できます。

### エージェント管理
- 一覧・詳細・新規作成・編集・削除
- 実行コマンドで環境変数（KERUTA_TASK_ID等）が利用可能
- インストールスクリプト設定: エージェントのインストールスクリプトを管理画面から設定できます。

### リポジトリ管理
- 一覧・詳細・新規作成・編集・削除の基本操作
- リポジトリURLとブランチ名の管理
- 認証情報（ユーザー名/パスワードまたはSSHキー）の設定
- インストールスクリプトの管理と実行

詳細は[リポジトリ管理ドキュメント](./repositoryManagement.md)を参照してください。

#### インストールスクリプト生成機能
リポジトリ管理画面からインストールスクリプトを視覚的に作成・編集できる機能です。コードを直接編集することなく、Webインターフェースを通じてスクリプトを管理できます。

**主な特徴:**
- **視覚的編集**: Monaco Editorを使用した直感的なスクリプト編集
- **テンプレート機能**: Node.js、Python、Java、Goなどプロジェクトタイプ別の事前定義テンプレート
- **リアルタイムプレビュー**: スクリプトの構文チェックとプレビュー機能
- **バージョン管理**: スクリプトの変更履歴とロールバック機能
- **検証機能**: スクリプトの構文エラー検出と修正提案

**画面構成:**
- スクリプト一覧画面: リポジトリごとのスクリプト管理
- スクリプト編集画面: コードエディタと各種設定パネル
- テンプレート選択画面: プロジェクトタイプ別テンプレート

**権限管理:**
| 操作 | 管理者 (admin) | 一般ユーザー (user) | 開発者 (developer) |
|------|:--------------:|:-------------------:|:------------------:|
| スクリプト閲覧 | ○ | ○ | ○ |
| スクリプト作成・編集 | ○ | × | ○ |
| スクリプト削除 | ○ | × | × |
| テスト実行 | ○ | × | ○ |

詳細は[インストールスクリプト生成機能ドキュメント](./adminPanelScriptGenerator.md)を参照してください。

### ドキュメント管理
- 一覧・新規作成・編集・削除・タグ付け・検索などが可能です。
- ドキュメントの内容やタグでフィルタリングできます。

### Kubernetes設定
- クラスタ設定やデフォルトイメージ、Namespaceなどの管理が可能です。
- マニフェストの編集やPodログの参照も可能です。
- 実行中のPodのマニフェスト（manifest）を確認できます。

## 権限ごとの操作可否
| 機能             | 管理者 (admin) | 一般ユーザー (user) | 開発者 (developer) |
|------------------|:--------------:|:-------------------:|:------------------:|
| タスク一覧・詳細閲覧 |      ○         |         ○           |         ○          |
| タスク作成・編集   |      ○         |         △（制限あり）|         ○          |
| タスク削除         |      ○         |         ×           |         ×          |
| キュー一覧・詳細閲覧 | ○ | ○ | ○ |
| キュー作成・編集 | ○ | △（制限あり） | ○ |
| キュー削除 | ○ | × | × |
| ワークスペース操作 | ○ | △（自分のみ） | ○ |
| エージェント管理   |      ○         |         ×           |         ×          |
| ドキュメント管理   |      ○         |         △（閲覧のみ）|         ○          |
| Kubernetes設定    |      ○         |         ×           |         ×          |
| インストールスクリプト閲覧 | ○ | ○ | ○ |
| インストールスクリプト作成・編集 | ○ | × | ○ |
| インストールスクリプト削除 | ○ | × | × |
| インストールスクリプトテスト実行 | ○ | × | ○ |

※△は権限設定やロールによって制御可能

### キュー管理
- 一覧・詳細・新規作成・編集・削除
- ワークスペース連携・状態監視・フィルタリング・検索
- キュー作成と同時にCoderワークスペースが自動作成されます
- キュー状態（PENDING/ACTIVE/COMPLETED/TERMINATED）の確認・追跡
- 関連ワークスペースへの直接アクセス機能

詳細は[キュー関連フォーム仕様](./queueFormSpec.md)を参照してください。

## ナビゲーション
- Dashboard, Tasks, Queues, Documents, Repositories, Kubernetes, Agents

## 技術情報
- Spring Boot, Thymeleaf（従来版）
- Remix.js, TypeScript, Tailwind CSS（新版）

## FAQ・トラブルシューティング
- ログインできない: Keycloak設定やネットワーク接続を確認
- タスクやエージェントが表示されない: APIサーバーの稼働確認
- 権限エラー: ユーザーロール設定を見直し

## 今後の予定
- ドキュメント管理機能の拡充、Kubernetes設定の詳細化・自動化、画面デザイン改善、多言語対応
- インストールスクリプト生成機能の拡張（AI支援生成、ビジュアルビルダー等）

---
ご意見・ご要望はIssueまたはPRでお知らせください。
