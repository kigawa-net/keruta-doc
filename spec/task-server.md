# keruta task server 仕様

## 概要

keruta task server は、タスクの管理、実行、監視を行うサーバーコンポーネントです。keruta
システムのコア部分として機能し、クライアントからのタスク要求を受け付け、Kubernetes 上でタスクを実行し、結果を管理します。

## アーキテクチャ

```

                        ┌─────────────────┐
                        │  ZooKeeper      │
                        └─────────────────┘
                              │
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Task Client   │◄──►│  Task Server    │◄──►│   provider      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                              │
                        ┌─────────────────┐
                        │  Object Storage │
                        └─────────────────┘
```

## 主要機能

### 1. タスク管理

- タスクの作成、更新、削除
- タスク状態の管理（PENDING, PROCESSING, COMPLETED, FAILED）
- タスクのメタデータ管理

### 2. タスク実行

- Provider によるタスク実行
- タイムアウトとリソース制限
- タスクの状態は [KTCP](./task-client-protocol.md) を使ってリアルタイムに更新

### 3. タスク監視

- タスク実行状態のリアルタイム監視
- ログストリーミング
- パフォーマンスメトリクス収集

### 4. データ永続化

- タスク結果のストレージ
- ログデータの保存
- メタデータの管理

### 5. エラー処理と自動修正

- エラー発生時の自動修正タスク生成
- 無限ループ防止メカニズム

