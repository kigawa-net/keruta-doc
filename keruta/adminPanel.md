# 管理パネルドキュメント

## 概要

Keruta管理パネルは、タスク、ドキュメント、リポジトリ、Kubernetesリソースを管理するためのウェブインターフェースを提供します。管理パネルは `/admin` パスからアクセスできます。

## アクセス方法

管理パネルには以下のURLでアクセスできます：

```
http://localhost:8080/admin
```

ルートパス (`http://localhost:8080/`) または `/welcome` パスにアクセスすると、自動的に管理パネルにリダイレクトされます。

## 画面イメージ例

> ※実際の画面キャプチャやUIイメージをここに挿入してください

- ダッシュボード
- タスク管理画面
- エージェント管理画面
- Kubernetes設定画面

## 機能

### ダッシュボード

ダッシュボードは管理パネルのホーム画面で、以下の情報を提供します：

- 最近のタスク（最大5件）の概要
- 各機能（タスク、ドキュメント、リポジトリ）へのクイックアクセスリンク
- API仕様書（Swagger UI）へのリンク

### タスク管理

タスク管理画面では、以下の操作が可能です：

- すべてのタスクの一覧表示
- タスクの詳細情報（ID、タイトル、説明、ステータス、優先度、作成日時、更新日時）の確認
- 新規タスクの作成
- 既存タスクの編集
- タスクの削除
- タスク実行時のPodログの閲覧

タスク一覧は `/admin/tasks` パスからアクセスできます。

#### タスクの作成

1. タスク一覧画面で「Create New Task」ボタンをクリック
2. タスク情報（タイトル、説明、優先度、ステータス）を入力
3. 「Save」ボタンをクリックして保存

#### タスクの編集

1. タスク一覧画面で編集したいタスクの「Edit」ボタンをクリック
2. タスク情報を更新
3. 「Save」ボタンをクリックして保存

#### タスクの削除

1. タスク一覧画面で削除したいタスクの「Delete」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

#### Podログの閲覧

1. タスク一覧またはタスク詳細画面で「Logs」ボタンをクリック
2. 実行ログモーダルが表示され、Podの標準出力と標準エラーが確認できます。
3. ログはリアルタイムで更新され、ダウンロードも可能です。

### エージェント管理

エージェント管理画面では、以下の操作が可能です：

- すべてのエージェントの一覧表示
- エージェントの詳細情報（ID、名前、対応言語、ステータス、現在のタスク、インストールコマンド、実行コマンド、作成日時、更新日時）の確認
- 新規エージェントの作成
- 既存エージェントの編集
- エージェントの削除

エージェント一覧は `/admin/agents` パスからアクセスできます。

#### エージェントの作成

1. エージェント一覧画面で「Create New Agent」ボタンをクリック
2. エージェント情報（名前、対応言語、ステータス、インストールコマンド、実行コマンド）を入力
   - 実行コマンドでは以下の環境変数が利用可能です:
     - `KERUTA_TASK_ID`: タスクID
     - `KERUTA_INPUT_FILE_PATH`: タスクの入力ファイルパス
     - `KERUTA_OUTPUT_DIR`: タスクの出力ディレクトリパス
3. 「Save」ボタンをクリックして保存

#### エージェントの編集

1. エージェント一覧画面で編集したいエージェントの「Edit」ボタンをクリック
2. エージェント情報を更新
3. 「Save」ボタンをクリックして保存

#### エージェントの削除

1. エージェント一覧画面で削除したいエージェントの「Delete」ボタンをクリック
2. 確認ダイアログで「OK」をクリック

### その他の機能

管理パネルには、以下の機能も含まれています（現在実装中）:

- ドキュメント管理
- リポジトリ管理
- Kubernetes設定

注：以前は別々だったタスクとジョブの機能は、現在は統合されています。タスク管理画面からKubernetesポッドの作成と管理が可能です。

## 権限ごとの操作可否

| 機能             | 管理者 (admin) | 一般ユーザー (user) |
|------------------|:--------------:|:-------------------:|
| タスク一覧・詳細閲覧 |      ○         |         ○           |
| タスク作成・編集   |      ○         |         △（制限あり）|
| タスク削除         |      ○         |         ×           |
| エージェント管理   |      ○         |         ×           |
| ドキュメント管理   |      ○         |         △（閲覧のみ）|
| Kubernetes設定    |      ○         |         ×           |

※△は権限設定やロールによって制御可能

## ナビゲーション

管理パネルの左側のサイドバーには、各機能へのリンクがあります：

- Dashboard - 管理パネルのホーム画面
- Tasks - タスク管理画面
- Documents - ドキュメント管理画面
- Repositories - リポジトリ管理画面
- Kubernetes - Kubernetes設定画面
- Agents - エージェント管理画面

## 技術情報

管理パネルは以下の技術を使用して実装されています：

- Spring Boot (バックエンド)
- Thymeleaf (テンプレートエンジン)
- Bootstrap 5 (フロントエンドフレームワーク)

## FAQ・トラブルシューティング

- ログインできない場合は、Keycloakの設定やネットワーク接続を確認してください。
- タスクやエージェントが表示されない場合は、APIサーバーが正常に稼働しているか確認してください。
- 権限エラーが出る場合は、ユーザーのロール設定を見直してください。

## 今後の予定・実装中機能

- ドキュメント管理機能の拡充
- Kubernetes設定の詳細化・自動化
- 画面デザインの改善
- 多言語対応

---

ご意見・ご要望はIssueまたはPRでお知らせください。
